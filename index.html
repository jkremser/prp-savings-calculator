<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kedify PodResourceProfile Savings Calculator</title>
  <meta name="description" content="Estimate cost savings from vertically scaling pods after startup using Kubernetes in-place resizes and Karpenter consolidation."/>
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --ink:#0f172a; --muted:#475569; --accent:#4f46e5; --ok:#059669; --bad:#b91c1c; --border:#e2e8f0; --chip:#eef2ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(#f8fafc,#fff) fixed;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;color:var(--ink)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
    header img{height:40px}
    h1{margin:0;font-size:26px;display:flex;gap:8px;align-items:center}
    .muted{color:var(--muted)}
    .links a{color:var(--accent);text-decoration:none;font-size:14px;margin-right:16px}
    .links a:hover{text-decoration:underline}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 1px 2px rgba(15,23,42,.06);padding:16px}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    label{font-weight:600;font-size:14px}
    input[type=number]{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;font-size:14px}
    input[type=range]{width:100%}
    .row{display:flex;gap:10px;align-items:center}
    .pill{display:inline-block;background:var(--chip);padding:6px 10px;border-radius:999px;font-size:12px}
    .small{font-size:12px;color:var(--muted)}
    .title{font-weight:600}
    .money{font-size:22px;font-weight:700}
    .good{color:var(--ok)} .bad{color:var(--bad)}
    .node{background:#f8fafc;border:1px solid var(--border);border-radius:12px;padding:12px}
    .node .head{font-weight:600;margin-bottom:4px}
    .twocol{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .tab{padding:8px 14px;border-radius:10px;background:#e2e8f0;color:#0f172a;cursor:pointer;border:1px solid transparent;user-select:none}
    .tab.active{background:var(--accent);color:#fff}
    .provider{margin-top:12px}
    .hidden{display:none}
    .logo-link{display:inline-block;transition:transform 0.3s ease}
    .logo-link:hover{transform:scale(1.15)}
    @media (max-width:860px){ .grid-2,.grid-3,.twocol{grid-template-columns:1fr} header{align-items:flex-start} }
  </style>
</head>
<body>
  <div class="wrap">
    <img src="logo.svg" alt="Kedify Logo" height="100px;" width="100px;" onerror="this.style.display='none'">
    <br/><br/>
    <header>
      <div>
        <h1>✨ Kedify PodResourceProfile Savings Calculator</h1>
        <div class="muted" style="margin-top:4px">Estimate cost savings from vertically scaling pods after startup using PodResourceProfiles (Kubernetes in‑place resizes) together with Karpenter consolidation.</div>
        <div class="links" style="margin-top:6px">
          <a href="https://docs.kedify.io/features/pod-resource-profiles/" target="_blank" rel="noopener noreferrer">PodResourceProfile Docs ↗</a>
          <a href="https://kedify.io/resources/blog/kubernetes-vertical-autoscaling" target="_blank" rel="noopener noreferrer">Blog: Kubernetes Vertical Autoscaling ↗</a>
        </div>
      </div>
    </header>

    <!-- Controls -->
    <section class="panel grid grid-2">
      <div class="grid" style="align-content:start">
        <div>
          <label>Replicas</label>
          <div class="row">
            <input id="replicasRange" type="range" min="1" max="500" step="1">
            <input id="replicas" type="number" min="1" step="1" style="width:120px">
          </div>
        </div>

        <div class="grid grid-2">
          <div>
            <label>Startup memory (GiB)</label>
            <input id="startup" type="number" step="0.1" min="0">
          </div>
          <div>
            <label>Steady memory (GiB)</label>
            <input id="steady" type="number" step="0.05" min="0">
          </div>
        </div>

        <div class="grid grid-2">
          <div>
            <label>Warmup duration (minutes)</label>
            <input id="warmup" type="number" step="1" min="0">
          </div>
          <div>
            <label>Allocatable fraction</label>
            <input id="alloc" type="number" step="0.01" min="0.5" max="0.98">
            <div class="small">Example: 0.85 ≈ 15% system overhead</div>
          </div>
        </div>

        <div class="small"><span id="footprint"></span></div>
      </div>

      <div class="panel" style="background:#f8fafc">
        <div class="pill">How it works</div>
        <ul class="small" style="margin-top:10px;line-height:1.45">
          <li>Chooses the cheapest node size in each provider catalog that can host your total <b>memory</b>, given <i>allocatable</i> per node.</li>
          <li>Before shrink packs <b>startup</b> memory; after shrink packs <b>steady</b> memory. Karpenter can consolidate nodes accordingly.</li>
          <li>Blended hourly = (<i>warmup</i>/60) × before + (1 − <i>warmup</i>/60) × after.</li>
          <li>Prices are placeholders — edit to your real on-demand/commit/Spot pricing below.</li>
        </ul>
      </div>
    </section>

    <!-- Tabs -->
    <div class="tabs" id="tabs"></div>

    <!-- Provider panels -->
    <section id="providers">
      <div id="aws"   class="panel provider"></div>
      <div id="gcp"   class="panel provider hidden"></div>
      <div id="azure" class="panel provider hidden"></div>
    </section>

    <div class="small" style="margin-top:8px">Note: This calculator relies on Karpenter and its effective node allocation</div>
    <a href="https://kedify.io" target="_blank" rel="noopener noreferrer" class="logo-link" style="float: right;">
      <img src="kedify-logo.png" alt="Kedify Logo" height="65px;" width="50px;" onerror="this.style.display='none'">
    </a>
  </div>

  <script>
    // ---------- Constants ----------
    const HOURS_PER_MONTH = 730; // typical cloud pricing convention
    const HOURS_PER_YEAR  = 8760;

    // ---------- Provider data (editable in UI) ----------
    const providers = {
      aws:   { label: "AWS EKS",    region: "eu-central-1 (Frankfurt)",
               nodes: [ {name:"m6i.large", vcpu:2, mem:8,  price:0.111},
                        {name:"m6i.xlarge", vcpu:4, mem:16, price:0.222},
                        {name:"m6i.2xlarge", vcpu:8, mem:32, price:0.444},
                        {name:"r6i.xlarge", vcpu:4, mem:32, price:0.302} ] },
      gcp:   { label: "Google GKE", region: "europe-west1 (Belgium)",
               nodes: [ {name:"n2-standard-2", vcpu:2, mem:8,  price:0.106},
                        {name:"n2-standard-4", vcpu:4, mem:16, price:0.214},
                        {name:"n2-standard-8", vcpu:8, mem:32, price:0.427},
                        {name:"n2-highmem-4", vcpu:4, mem:32, price:0.287} ] },
      azure: { label: "Azure AKS",  region: "westeurope (Netherlands)",
               nodes: [ {name:"D2s_v5", vcpu:2, mem:8,  price:0.096},
                        {name:"D4s_v5", vcpu:4, mem:16, price:0.192},
                        {name:"D8s_v5", vcpu:8, mem:32, price:0.384},
                        {name:"E4as_v5", vcpu:4, mem:32, price:0.248} ] },
    };

    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);
    const usd = (n) => n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:4});
    const ceilDiv = (a,b) => Math.ceil(a/b);

    function bestPlanByMemory(totalMemGiB, allocPct, catalog){
      let best = null;
      for(const n of catalog){
        const allocPerNode = n.mem * allocPct;
        if (allocPerNode <= 0) continue;
        const count = ceilDiv(totalMemGiB, allocPerNode);
        const cost  = count * n.price;
        if(!best || cost < best.hourlyCost) best = { node:n, count, hourlyCost:cost, allocPerNode };
      }
      return best;
    }

    // ---------- State + bindings ----------
    const state = { replicas:12, startup:2, steady:0.75, warmup:5, alloc:0.85, activeTab:"aws" };

    function bindControls(){
      const rr = $("replicasRange"), rn = $("replicas");
      rr.value = state.replicas; rn.value = state.replicas;
      rr.addEventListener("input", e => { state.replicas = +e.target.value; rn.value = state.replicas; render(); });
      rn.addEventListener("input", e => { state.replicas = Math.max(1, +e.target.value || 1); rr.value = state.replicas; render(); });

      const ids = ["startup","steady","warmup","alloc"];
      ids.forEach(id => {
        const el = $(id);
        el.value = state[id];
        el.addEventListener("input", e => { state[id] = +e.target.value; render(); });
      });
    }

    function buildTabs(){
      const tabs = $("tabs");
      tabs.innerHTML = "";
      for(const key of Object.keys(providers)){
        const t = document.createElement("div");
        t.className = "tab" + (state.activeTab === key ? " active" : "");
        t.textContent = key.toUpperCase();
        t.addEventListener("click", () => { state.activeTab = key; switchTab(); });
        tabs.appendChild(t);
      }
    }

    function switchTab(){
      document.querySelectorAll(".tab").forEach((el, i) => {
        const keys = Object.keys(providers);
        el.classList.toggle("active", keys[i] === state.activeTab);
      });
      for(const key of Object.keys(providers)){
        $(key).classList.toggle("hidden", key !== state.activeTab);
      }
    }

    // ---------- Rendering ----------
    function render(){
      // compute totals
      const totalStartup = state.replicas * state.startup;
      const totalSteady  = state.replicas * state.steady;
      $("footprint").textContent = `Total startup: ${totalStartup.toFixed(2)} GiB • steady: ${totalSteady.toFixed(2)} GiB`;

      // build cards for each provider
      for(const [key, p] of Object.entries(providers)){
        const before = bestPlanByMemory(totalStartup, state.alloc, p.nodes);
        const after  = bestPlanByMemory(totalSteady,  state.alloc, p.nodes);
        if(!before || !after){ $(key).innerHTML = "<div class='small'>No valid node options.</div>"; continue; }

        const wf = Math.min(Math.max(state.warmup/60, 0), 1);
        const blended = before.hourlyCost*wf + after.hourlyCost*(1-wf);
        const savingsHourly = before.hourlyCost - blended;
        const savingsMonthly = savingsHourly * HOURS_PER_MONTH;
        const savingsYearly  = savingsHourly * HOURS_PER_YEAR;

        const savingClass = savingsHourly >= 0 ? "good" : "bad";

        $(key).innerHTML = `
          <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start">
            <div>
              <div class="title" style="font-size:18px">${p.label} <span class="muted" style="font-weight:400">— ${p.region}</span></div>
              <div class="small">Saving hourly</div>
              <div class="money ${savingClass}">${usd(savingsHourly)}</div>
              <div class="small" style="margin-top:6px">Saving monthly</div>
              <div class="money ${savingClass}" style="font-size:18px">${usd(savingsMonthly)}</div>
              <div class="small" style="margin-top:6px">Saving yearly</div>
              <div class="money ${savingClass}" style="font-size:18px">${usd(savingsYearly)}</div>
            </div>
            <div class="twocol" style="min-width:280px">
              ${planPanel("Before shrink (startup)", before)}
              ${planPanel("After shrink (steady)",  after)}
            </div>
          </div>
          <div class="small" style="margin-top:8px">Shrink action: <b>${before.count} × ${before.node.name}</b> → <b>${after.count} × ${after.node.name}</b></div>
          <div style="height:12px"></div>
          <div class="pill">Node catalog (edit $/h or RAM)</div>
          <div class="grid grid-3" style="margin-top:10px">
            ${catalogEditor(key, p.nodes)}
          </div>
        `;
      }
      switchTab();
    }

    function planPanel(title, plan){
      return `
        <div class="node">
          <div class="head">${title}</div>
          <div class="small">Cost: ${usd(plan.hourlyCost)}/h</div>
          <div class="pill" style="margin-top:6px">${plan.count} × ${plan.node.name}</div>
          <div class="small" style="margin-top:6px">Allocatable/node: ${plan.allocPerNode.toFixed(1)} GiB</div>
        </div>
      `;
    }

    function catalogEditor(providerKey, nodes){
      return nodes.map((n, idx) => {
        const pid = `${providerKey}-node-${idx}`;
        return `
          <div class="node">
            <div class="head">${n.name}</div>
            <div class="small">${n.vcpu||'?'} vCPU • <span id="${pid}-mem">${n.mem}</span> GiB RAM</div>
            <div class="row small" style="margin-top:6px">
              <span>$/h</span>
              <input id="${pid}-price" type="number" step="0.001" value="${n.price}" style="width:120px">
            </div>
            <div class="row small" style="margin-top:6px">
              <span>Mem (GiB)</span>
              <input id="${pid}-memInput" type="number" step="0.5" value="${n.mem}" style="width:120px">
            </div>
          </div>
        `;
      }).join("");
    }

    function wireCatalogInputs(){
      for(const [key, p] of Object.entries(providers)){
        p.nodes.forEach((n, idx) => {
          const priceEl = $(`${key}-node-${idx}-price`);
          const memEl   = $(`${key}-node-${idx}-memInput`);
          const memText = $(`${key}-node-${idx}-mem`);
          if(priceEl){
            priceEl.addEventListener("input", e => { n.price = +e.target.value; render(); wireCatalogInputs(); });
          }
          if(memEl){
            memEl.addEventListener("input", e => { n.mem = +e.target.value; if(memText) memText.textContent = n.mem; render(); wireCatalogInputs(); });
          }
        });
      }
    }

    // ---------- Init ----------
    bindControls();
    buildTabs();
    render();
    // Re-wire catalog inputs after first render because they are created dynamically
    const observer = new MutationObserver(() => wireCatalogInputs());
    observer.observe($("providers"), { childList:true, subtree:true });
  </script>
</body>
</html>
